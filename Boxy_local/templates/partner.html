{% extends "base.html" %}

{% block title %}Become a Partner - Boxy{% endblock %}

{% block content %}
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top shadow-sm">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
            <div class="brand-icon brand-icon-logo me-2">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Boxy" class="brand-logo-img">
            </div>
            <span class="fw-bold">Boxy</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-center">
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('index') }}">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('send_parcel') }}">Send Parcel</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('track_parcel') }}">Track Parcel</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('admin') }}">Admin</a>
                </li>
                <li class="nav-item ms-3">
                    <a class="btn btn-primary btn-partner active" href="{{ url_for('partner') }}">Become a Partner</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Partner Login Modal Overlay with Animation -->
<div id="partnerLoginModal" class="modal-overlay" style="display: none;">
    <div class="auth-container">
        <!-- Cancel/Close Button -->
        <button type="button" class="modal-close-btn" id="closePartnerLoginModal" title="Close and return to home">
            <i class="fas fa-times"></i>
        </button>
        <div class="auth-box" id="partnerAuthBox">
            <!-- Sign In Panel (Left) -->
            <div class="sign-in-panel active" id="partnerSignInPanel">
                <div class="form-wrapper">
                    <h2 class="auth-title animation">Partner Sign In</h2>
                    <p class="auth-subtitle animation">Welcome back! Please login to continue</p>
                    
                    <form id="partnerLoginFormModal" class="auth-form">
                        <div class="input-box animation">
                            <i class="fas fa-envelope input-icon"></i>
                            <input type="text" id="partnerLoginEmail" placeholder="Email or Phone" required>
                        </div>
                        
                        <div class="input-box animation">
                            <i class="fas fa-lock input-icon"></i>
                            <input type="password" id="partnerLoginPassword" placeholder="Password" required>
                        </div>
                        
                        <button type="submit" class="btn-auth animation">
                            <span>SIGN IN</span>
                        </button>
                    </form>
                    
                    <div id="partnerLoginError" class="error-message animation d-none"></div>
                </div>
            </div>
            
            <!-- Sign Up Panel (Right) -->
            <div class="sign-up-panel active" id="partnerSignUpPanel">
                <iframe src='https://my.spline.design/retrofuturismbganimation-MdCzov4NeMEKgneVrnkxbzMS/' frameborder='0' width='100%' height='100%' class="spline-iframe"></iframe>
                <div class="overlay-panel">
                    <h2 class="overlay-title animation">Hello, Partner!</h2>
                    <p class="overlay-text animation">Enter your details and join our delivery team</p>
                    <button type="button" class="ghost-btn animation" id="partnerShowRegisterBtn">
                        <span>SIGN UP</span>
                    </button>
                </div>
            </div>
            
            <!-- Registration Form Panel (Slides in from right) -->
            <div class="register-panel" id="partnerRegisterPanel">
                <div class="form-wrapper" style="overflow-y: auto; max-height: 550px;">
                    <h2 class="auth-title animation">Create Partner Account</h2>
                    <p class="auth-subtitle animation">Fill in your details to get started</p>
                    
                    <form id="partnerRegisterFormModal" class="auth-form">
                        <div class="input-box animation">
                            <i class="fas fa-user input-icon"></i>
                            <input type="text" id="partnerRegFirstName" placeholder="First Name" required>
                        </div>
                        
                        <div class="input-box animation">
                            <i class="fas fa-user input-icon"></i>
                            <input type="text" id="partnerRegLastName" placeholder="Last Name" required>
                        </div>
                        
                        <div class="input-box animation">
                            <i class="fas fa-envelope input-icon"></i>
                            <input type="email" id="partnerRegEmail" placeholder="Email" required>
                        </div>
                        
                        <div class="input-box animation">
                            <i class="fas fa-phone input-icon"></i>
                            <input type="tel" id="partnerRegPhone" placeholder="Phone" required>
                        </div>
                        
                        <div class="input-box animation">
                            <i class="fas fa-truck input-icon"></i>
                            <select id="partnerRegVehicle" style="width: 100%; padding: 15px; border: none; outline: none; background: transparent; font-size: 1rem; color: #333;" required>
                                <option value="">Vehicle Type</option>
                                <option value="bike">Bike</option>
                                <option value="scooter">Scooter</option>
                                <option value="cycle">Cycle</option>
                                <option value="car">Car</option>
                            </select>
                        </div>
                        
                        <div class="input-box animation">
                            <i class="fas fa-car input-icon"></i>
                            <input type="text" id="partnerRegVehicleNumber" placeholder="Vehicle Number" required>
                        </div>
                        
                        <div class="input-box animation">
                            <i class="fas fa-id-card input-icon"></i>
                            <input type="text" id="partnerRegAadhar" placeholder="Aadhar Number" maxlength="12" required>
                        </div>
                        
                        <div class="input-box animation">
                            <i class="fas fa-lock input-icon"></i>
                            <input type="password" id="partnerRegPassword" placeholder="Password" required>
                        </div>
                        
                        <button type="submit" class="btn-auth animation">
                            <span>SIGN UP</span>
                        </button>
                    </form>
                    
                    <div class="toggle-auth animation">
                        <p class="toggle-text">Already have an account? <a href="#" id="partnerShowLoginLink" class="toggle-link">Sign In</a></p>
                    </div>
                    
                    <div id="partnerRegisterError" class="error-message animation d-none"></div>
                </div>
            </div>
            
            <!-- Welcome Back Panel (Slides in from left when switching to login) -->
            <div class="welcome-panel" id="partnerWelcomePanel">
                <iframe src='https://my.spline.design/retrofuturismbganimation-MdCzov4NeMEKgneVrnkxbzMS/' frameborder='0' width='100%' height='100%' class="spline-iframe"></iframe>
                <div class="overlay-panel">
                    <h2 class="overlay-title animation">Welcome Back!</h2>
                    <p class="overlay-text animation">To keep connected with us please login with your personal info</p>
                    <button type="button" class="ghost-btn animation" id="partnerShowLoginBtn">
                        <span>SIGN IN</span>
                    </button>
                </div>
            </div>
            
        </div>
    </div>
</div>

<!-- Partner Section -->
<section class="partner-page-section py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Header -->
                <div class="text-center mb-5 d-none" id="pageHeader">
                    <div class="partner-icon mb-3">
                        <i class="fas fa-truck"></i>
                    </div>
                    <h1 class="section-title mb-3">Become a Delivery Partner</h1>
                    <p class="section-description">
                        Join our team of delivery partners and start earning. Work on your own schedule with flexible hours.
                    </p>
                </div>

                <!-- Partner Dashboard (Hidden by default) -->
                <div id="partnerDashboard" class="d-none">
                    <!-- Dashboard Header -->
                    <div class="dashboard-header card border-0 shadow-sm mb-4">
                        <div class="card-body p-4">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center">
                                        <div class="partner-avatar-circle me-3">
                                            <i class="fas fa-user-cog"></i>
                                        </div>
                                        <div>
                                            <h4 class="mb-0" id="partnerName">Demo Partner</h4>
                                            <p class="text-muted mb-0" id="partnerId">ID: DP1001</p>
                                        </div>
                                    </div>
                                    <!-- New Delivery Requests Bar (shown when live) -->
                                    <div id="newDeliveryBar" class="mt-3 d-none">
                                        <div class="alert alert-success mb-0 py-2">
                                            <i class="fas fa-bell me-2"></i>
                                            <span id="newDeliveryCount">0</span> new delivery requests available nearby
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 text-end">
                                    <div class="d-flex align-items-center justify-content-end gap-3">
                                        <button class="btn btn-lg btn-go-live" id="goLiveBtn" onclick="toggleGoLive()">
                                            <i class="fas fa-power-off me-2"></i>Tap to Go Live
                                        </button>
                                        <button class="btn btn-success btn-lg" id="liveStatusBtn" onclick="toggleGoLive()" style="display: none;">
                                            <i class="fas fa-bolt me-2"></i>You are LIVE
                                        </button>
                                        <button class="btn btn-danger btn-square" id="goLiveArrow" onclick="toggleGoLive()" style="display: none;">
                                            <i class="fas fa-arrow-right"></i>
                                        </button>
                                        <button class="btn btn-outline-danger" id="partnerLogoutBtn">
                                            <i class="fas fa-sign-out-alt me-2"></i>Logout
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <div class="stat-card-small bg-primary text-white p-3 rounded text-center">
                                <h6 class="mb-1">Total Deliveries</h6>
                                <h3 class="mb-0" id="totalDeliveries">0</h3>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card-small bg-success text-white p-3 rounded text-center">
                                <h6 class="mb-1">Completed</h6>
                                <h3 class="mb-0" id="completedDeliveries">0</h3>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card-small bg-warning text-white p-3 rounded text-center">
                                <h6 class="mb-1">In Progress</h6>
                                <h3 class="mb-0" id="inProgressDeliveries">0</h3>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card-small bg-info text-white p-3 rounded text-center">
                                <h6 class="mb-1">Earnings</h6>
                                <h3 class="mb-0" id="totalEarnings">â‚¹0</h3>
                            </div>
                        </div>
                    </div>

                    <!-- Delivery Requests Tabs -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-light p-0">
                            <ul class="nav nav-tabs nav-tabs-custom" id="deliveryTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="available-tab" data-bs-toggle="tab" data-bs-target="#available-deliveries" type="button">
                                        Available
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="active-tab" data-bs-toggle="tab" data-bs-target="#active-deliveries" type="button">
                                        Active (<span id="activeCountBadge">0</span>)
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed-deliveries" type="button">
                                        Completed (<span id="completedCountBadge">0</span>)
                                    </button>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content" id="deliveryTabContent">
                                <div class="tab-pane fade show active" id="available-deliveries">
                                    <div id="availableDeliveriesList">
                                        <!-- Offline Message -->
                                        <div id="offlineMessage" class="offline-status-card">
                                            <div class="offline-icon-wrapper">
                                                <i class="fas fa-power-off"></i>
                                            </div>
                                            <h4 class="mt-3 mb-2">You're Offline</h4>
                                            <p class="text-muted">Tap the "Go Live" button above to start receiving delivery requests</p>
                                        </div>
                                        <!-- Looking for Deliveries (when live but no deliveries) -->
                                        <div id="lookingForDeliveries" class="looking-for-deliveries-card d-none">
                                            <div class="looking-icon-wrapper">
                                                <i class="fas fa-box"></i>
                                            </div>
                                            <h4 class="mt-3 mb-2">Looking for deliveries...</h4>
                                            <p class="text-muted">We'll notify you when new jobs are available.</p>
                                            <div class="live-ready-indicator mt-4">
                                                <span class="live-dot"></span>
                                                <span class="ms-2">You're live and ready</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="active-deliveries">
                                    <div id="activeDeliveriesList">
                                        <p class="text-muted text-center">No active deliveries.</p>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="completed-deliveries">
                                    <div id="completedDeliveriesList">
                                        <p class="text-muted text-center">No completed deliveries yet.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</section>

<!-- Go Live Modal -->
<div class="modal fade" id="goLiveModal" tabindex="-1" aria-labelledby="goLiveModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-body text-center p-5">
                <div class="go-live-icon mb-4">
                    <i class="fas fa-bolt"></i>
                </div>
                <h2 class="mb-3">You're Now Live!</h2>
                <p class="text-muted mb-4">Start accepting delivery requests</p>
                <button type="button" class="btn btn-orange btn-lg" data-bs-dismiss="modal">
                    Got it!
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="footer bg-dark text-white py-5">
    <div class="container">
        <div class="row g-4">
            <div class="col-lg-3 col-md-6">
                <h5 class="mb-3">Boxy</h5>
                <p class="text-white-50">
                    Fast, reliable, and affordable parcel delivery service. Your packages delivered with care.
                </p>
                <div class="social-links mt-3">
                    <a href="#" class="text-white me-3"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-white me-3"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-white"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <h5 class="mb-3">Quick Links</h5>
                <ul class="list-unstyled">
                    <li><a href="{{ url_for('index') }}" class="text-white-50 text-decoration-none">Home</a></li>
                    <li><a href="{{ url_for('send_parcel') }}" class="text-white-50 text-decoration-none">Send Parcel</a></li>
                    <li><a href="{{ url_for('track_parcel') }}" class="text-white-50 text-decoration-none">Track Parcel</a></li>
                    <li><a href="{{ url_for('admin') }}" class="text-white-50 text-decoration-none">Admin Login</a></li>
                    <li><a href="{{ url_for('partner') }}" class="text-white-50 text-decoration-none">Partner Login</a></li>
                </ul>
            </div>
            <div class="col-lg-3 col-md-6">
                <h5 class="mb-3">Services</h5>
                <ul class="list-unstyled">
                    <li><a href="#" class="text-white-50 text-decoration-none">Same Day Delivery</a></li>
                    <li><a href="#" class="text-white-50 text-decoration-none">Express Shipping</a></li>
                    <li><a href="#" class="text-white-50 text-decoration-none">Standard Delivery</a></li>
                    <li><a href="#" class="text-white-50 text-decoration-none">Live Tracking</a></li>
                </ul>
            </div>
            <div class="col-lg-3 col-md-6">
                <h5 class="mb-3">Contact Us</h5>
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="fas fa-phone me-2"></i>
                        <a href="tel:+15551234567" class="text-white-50 text-decoration-none">+1 (555) 123-4567</a>
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-envelope me-2"></i>
                        <a href="mailto:support@boxy.com" class="text-white-50 text-decoration-none">support@boxy.com</a>
                    </li>
                    <li>
                        <i class="fas fa-map-marker-alt me-2"></i>
                        <span class="text-white-50">123 Delivery Street, Logistics City, LC 12345</span>
                    </li>
                </ul>
            </div>
        </div>
        <hr class="my-4 bg-white-50">
        <div class="text-center">
            <p class="text-white-50 mb-0">&copy; 2025 Boxy. All rights reserved.</p>
        </div>
    </div>
</footer>
{% endblock %}

{% block extra_css %}
<style>
/* Partner Login Modal Overlay */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    animation: fadeIn 0.5s ease-in;
    backdrop-filter: blur(3px);
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
}

.auth-container {
    background-color: #fff;
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    width: 90%;
    max-width: 900px;
    max-height: 90vh;
    overflow: hidden;
    position: relative;
    animation: slideUp 0.5s ease-out;
    display: flex;
    flex-direction: column;
}

/* Modal Close Button */
.modal-close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 40px;
    height: 40px;
    background: rgba(0, 0, 0, 0.1);
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10000;
    transition: all 0.3s ease;
    color: #333;
    font-size: 1.2rem;
}

.modal-close-btn:hover {
    background: rgba(0, 0, 0, 0.2);
    transform: scale(1.1);
    color: #000;
}

.modal-close-btn:active {
    transform: scale(0.95);
}

.auth-box {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    min-height: 550px;
}

/* Sign In Panel (Left) */
.sign-in-panel {
    width: 50%;
    padding: 60px 50px;
    background: #fff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    transition: transform 0.6s ease-in-out;
    z-index: 2;
}

.sign-in-panel.active {
    transform: translateX(0);
}

.sign-in-panel.inactive {
    transform: translateX(-100%);
}

/* Sign Up Panel (Right - Welcome) */
.sign-up-panel {
    position: absolute;
    top: 0;
    right: 0;
    width: 50%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px 50px;
    transition: transform 0.6s ease-in-out, opacity 0.6s ease-in-out;
    z-index: 1;
    overflow: hidden;
}

.spline-iframe {
    position: absolute;
    top: -5%;
    left: -5%;
    width: 110%;
    height: 110%;
    border: none;
    z-index: 0;
    pointer-events: auto;
    transform: scale(1.1);
    transform-origin: center center;
    overflow: hidden;
}

.sign-up-panel.active {
    transform: translateX(0) !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: flex !important;
}

.sign-up-panel.inactive {
    transform: translateX(100%);
    opacity: 0;
    visibility: hidden;
}

/* Register Form Panel */
.register-panel {
    position: absolute;
    top: 0;
    right: 0;
    width: 50%;
    height: 100%;
    background: #fff;
    padding: 40px 50px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: stretch;
    transform: translateX(100%);
    transition: transform 0.6s ease-in-out;
    z-index: 2;
    overflow-y: auto;
}

.register-panel.active {
    transform: translateX(0);
}

/* Welcome Panel */
.welcome-panel {
    position: absolute;
    top: 0;
    left: 0;
    width: 50%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px 50px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    transition: transform 0.6s ease-in-out, opacity 0.6s ease-in-out;
    z-index: 1;
    overflow: hidden;
    transform: translateX(-100%);
}

.welcome-panel.active {
    transform: translateX(0);
    opacity: 1;
    visibility: visible;
}

.overlay-panel {
    position: relative;
    z-index: 2;
    text-align: center;
    color: white;
}

.overlay-title {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 20px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.overlay-text {
    font-size: 1.1rem;
    margin-bottom: 30px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.form-wrapper {
    width: 100%;
    max-width: 100%;
}

.auth-title {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 10px;
    color: #333;
}

.auth-subtitle {
    font-size: 0.9rem;
    color: #666;
    margin-bottom: 30px;
}

.auth-form {
    width: 100%;
}

.input-box {
    position: relative;
    margin-bottom: 20px;
    background: #f5f5f5;
    border-radius: 10px;
    padding: 5px 15px;
    display: flex;
    align-items: center;
    transition: all 0.3s ease;
}

.input-box:focus-within {
    background: #fff;
    box-shadow: 0 0 0 2px #667eea;
}

.input-box input,
.input-box select {
    flex: 1;
    border: none;
    outline: none;
    padding: 15px 10px;
    background: transparent;
    font-size: 1rem;
    color: #333;
}

.input-icon {
    color: #999;
    margin-right: 10px;
    font-size: 1.1rem;
}

.btn-auth {
    width: 100%;
    height: 50px;
    background: #000;
    border: none;
    border-radius: 10px;
    color: white;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    margin-top: 10px;
}

.btn-auth:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
    background: #333;
}

.ghost-btn {
    background: transparent;
    border: 2px solid white;
    color: white;
    padding: 12px 40px;
    border-radius: 50px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.ghost-btn:hover {
    background: #000;
    border-color: #000;
}

.toggle-auth {
    text-align: center;
    margin-top: 20px;
}

.toggle-text {
    color: #666;
    font-size: 0.9rem;
}

.toggle-link {
    color: #667eea;
    text-decoration: none;
    font-weight: bold;
    transition: color 0.3s ease;
}

.toggle-link:hover {
    color: #764ba2;
    text-decoration: underline;
}

.error-message {
    background: #fee;
    color: #c33;
    padding: 12px;
    border-radius: 8px;
    margin-top: 15px;
    font-size: 0.9rem;
}

.animation {
    animation: fadeInUp 0.6s ease-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes slideUp {
    from {
        transform: translateY(50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .auth-container {
        width: 95%;
        min-height: auto;
    }
    
    .sign-in-panel,
    .sign-up-panel,
    .register-panel,
    .welcome-panel {
        width: 100%;
        padding: 40px 30px;
    }
    
    .sign-in-panel.inactive,
    .sign-up-panel.inactive,
    .register-panel.active,
    .welcome-panel.active {
        transform: translateX(0);
    }
    
    .overlay-title {
        font-size: 2rem;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Partner Modal JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // Toggle between login and registration forms
    const partnerShowRegisterBtn = document.getElementById('partnerShowRegisterBtn');
    const partnerShowLoginBtn = document.getElementById('partnerShowLoginBtn');
    const partnerShowLoginLink = document.getElementById('partnerShowLoginLink');
    
    if (partnerShowRegisterBtn) {
        partnerShowRegisterBtn.addEventListener('click', function(e) {
            e.preventDefault();
            showPartnerRegisterForm();
        });
    }
    
    if (partnerShowLoginBtn) {
        partnerShowLoginBtn.addEventListener('click', function(e) {
            e.preventDefault();
            showPartnerLoginForm();
        });
    }
    
    if (partnerShowLoginLink) {
        partnerShowLoginLink.addEventListener('click', function(e) {
            e.preventDefault();
            showPartnerLoginForm();
        });
    }
    
    // Handle login form submission
    const partnerLoginFormModal = document.getElementById('partnerLoginFormModal');
    if (partnerLoginFormModal) {
        partnerLoginFormModal.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('partnerLoginEmail').value;
            const password = document.getElementById('partnerLoginPassword').value;
            const errorDiv = document.getElementById('partnerLoginError');
            
            errorDiv.classList.add('d-none');
            
            try {
                const response = await fetch('/api/partner/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Store partner data
                    localStorage.setItem('currentPartner', JSON.stringify(data.partner));
                    
                    // Hide modal
                    const modal = document.getElementById('partnerLoginModal');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                    
                    // Reload page to show dashboard (partner.js will handle it)
                    window.location.reload();
                } else {
                    errorDiv.textContent = data.message || 'Login failed';
                    errorDiv.classList.remove('d-none');
                }
            } catch (error) {
                console.error('Login error:', error);
                errorDiv.textContent = 'An error occurred. Please try again.';
                errorDiv.classList.remove('d-none');
            }
        });
    }
    
    // Handle registration form submission
    const partnerRegisterFormModal = document.getElementById('partnerRegisterFormModal');
    if (partnerRegisterFormModal) {
        partnerRegisterFormModal.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const password = document.getElementById('partnerRegPassword').value;
            const errorDiv = document.getElementById('partnerRegisterError');
            
            errorDiv.classList.add('d-none');
            
            try {
                const response = await fetch('/api/partner/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        firstName: document.getElementById('partnerRegFirstName').value,
                        lastName: document.getElementById('partnerRegLastName').value,
                        email: document.getElementById('partnerRegEmail').value,
                        phone: document.getElementById('partnerRegPhone').value,
                        vehicleType: document.getElementById('partnerRegVehicle').value,
                        vehicleNumber: document.getElementById('partnerRegVehicleNumber').value,
                        aadhar: document.getElementById('partnerRegAadhar').value,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Show success and switch to login
                    errorDiv.textContent = 'Registration successful! Please login.';
                    errorDiv.style.background = '#efe';
                    errorDiv.style.color = '#3c3';
                    errorDiv.classList.remove('d-none');
                    document.getElementById('partnerRegisterFormModal').reset();
                    
                    setTimeout(() => {
                        showPartnerLoginForm();
                    }, 2000);
                } else {
                    errorDiv.textContent = data.message || 'Registration failed';
                    errorDiv.classList.remove('d-none');
                }
            } catch (error) {
                console.error('Registration error:', error);
                errorDiv.textContent = 'An error occurred. Please try again.';
                errorDiv.classList.remove('d-none');
            }
        });
    }
    
    // Set up close modal button - redirect to home page
    const closePartnerModalBtn = document.getElementById('closePartnerLoginModal');
    if (closePartnerModalBtn) {
        closePartnerModalBtn.addEventListener('click', function() {
            window.location.href = '{{ url_for("index") }}';
        });
    }
});

function showPartnerRegisterForm() {
    document.getElementById('partnerSignInPanel').classList.remove('active');
    document.getElementById('partnerSignInPanel').classList.add('inactive');
    document.getElementById('partnerSignUpPanel').classList.remove('active');
    document.getElementById('partnerSignUpPanel').classList.add('inactive');
    document.getElementById('partnerRegisterPanel').classList.add('active');
    document.getElementById('partnerWelcomePanel').classList.add('active');
}

function showPartnerLoginForm() {
    document.getElementById('partnerSignInPanel').classList.add('active');
    document.getElementById('partnerSignInPanel').classList.remove('inactive');
    document.getElementById('partnerSignUpPanel').classList.add('active');
    document.getElementById('partnerSignUpPanel').classList.remove('inactive');
    document.getElementById('partnerRegisterPanel').classList.remove('active');
    document.getElementById('partnerWelcomePanel').classList.remove('active');
}

function hidePartnerModal() {
    const modal = document.getElementById('partnerLoginModal');
    if (modal) {
        modal.style.display = 'none';
    }
}

async function checkPartnerLoginStatus() {
    try {
        const response = await fetch('/api/partner/status', {
            method: 'GET',
            credentials: 'include'
        });
        const data = await response.json();
        
        if (!data.success) {
            // Not logged in, show modal
            const modal = document.getElementById('partnerLoginModal');
            if (modal) {
                modal.style.display = 'flex';
            }
        } else {
            // Logged in, hide modal
            hidePartnerModal();
        }
    } catch (error) {
        // Error checking status, show modal anyway
        const modal = document.getElementById('partnerLoginModal');
        if (modal) {
            modal.style.display = 'flex';
        }
    }
}
</script>
<script src="{{ url_for('static', filename='js/partner.js') }}"></script>
{% endblock %}
